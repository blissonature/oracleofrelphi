<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Planetary Hours</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 2rem; }
    .card { max-width: 640px; border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .hrs { display: grid; grid-template-columns: 1fr 1fr; gap: 6px 12px; margin-top: 12px; }
    .hr { padding: 6px 8px; border-radius: 8px; border: 1px solid #eee; }
    .hr.now { border-color: #000; font-weight: 600; background: #fafafa; }
    .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .tiny { font-size: 12px; color: #666; }
    .pill { padding: 4px 8px; border: 1px solid #ddd; border-radius: 999px; background:#fff; }
    .bar { height: 8px; background: #eee; border-radius: 999px; overflow: hidden; }
    .bar > div { height: 100%; width: 0%; background: #000; }
    button, input, select { padding: 6px 8px; }
    label { font-size: 12px; color: #444; }
    .ticker { display:flex; justify-content:space-between; margin:12px 0; }
    .ticker span { flex:1; text-align:center; font-size:14px; }
    .ticker .current { font-weight:700; background:#f0f0f0; border-radius:12px; padding:2px 6px; }
    .links { display:flex; gap:12px; margin-top:10px; }
    .links a { padding:6px 12px; border:1px solid #ddd; border-radius:999px; text-decoration:none; font-size:14px; }
  </style>
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
</head>
<body>
  <div class="card">
    <div class="tiny">Current Planetary Hour</div>
    <h1 id="current">–</h1>
    <div id="dayruler" class="tiny">–</div>
    <div id="nowtime" class="tiny mono">–</div>

    <div class="row" style="margin-top:6px;">
      <span class="pill mono" id="range">–</span>
      <span class="pill mono" id="elapsed">–</span>
      <span class="pill mono" id="remain">–</span>
      <span class="pill" id="weekday">–</span>
    </div>

    <div class="ticker">
      <span id="prev">–</span>
      <span class="current" id="curTicker">–</span>
      <span id="next">–</span>
    </div>

    <div class="row" style="margin-top:6px;">
      <div>
        <div class="tiny">Location</div>
        <div class="row">
          <button id="geoBtn">Use my location</button>
          <label>Lat <input id="lat" size="8" /></label>
          <label>Lon <input id="lon" size="8" /></label>
          <button id="setBtn">Set</button>
        </div>
        <label class="tiny">Timezone <select id="tzSelect"></select></label>
        <button id="tzBtn">Use timezone</button>
        <div class="tiny mono" id="locEcho">–</div>
      </div>
    </div>

    <div class="links">
      <a href="https://chatgpt.com/g/g-68606a9ece40819191154b836fcd2846-oracle-of-relphi" target="_blank">Commune with the Oracle</a>
      <a href="https://ko-fi.com/oracleofrelphi" target="_blank">Donate</a>
    </div>

    <div style="margin:12px 0;">
      <div class="tiny">Progress</div>
      <div class="bar"><div id="progress"></div></div>
    </div>

    <div class="tiny" id="suninfo">–</div>

    <div class="hrs" id="list"></div>
  </div>

<script>
(function(){
  const ORDER = ["Saturn","Jupiter","Mars","Sun","Venus","Mercury","Moon"];
  const DAY_RULER = {0:"Sun",1:"Moon",2:"Mars",3:"Mercury",4:"Jupiter",5:"Venus",6:"Saturn"};
  const WEEKDAY_NAME = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

  const elCurrent=document.getElementById('current'),
        elDayruler=document.getElementById('dayruler'),
        elNowtime=document.getElementById('nowtime'),
        elRange=document.getElementById('range'),
        elElapsed=document.getElementById('elapsed'),
        elRemain=document.getElementById('remain'),
        elWeekday=document.getElementById('weekday'),
        elList=document.getElementById('list'),
        elSuninfo=document.getElementById('suninfo'),
        elProgress=document.getElementById('progress'),
        elLocEcho=document.getElementById('locEcho'),
        elPrev=document.getElementById('prev'),
        elCurTicker=document.getElementById('curTicker'),
        elNext=document.getElementById('next'),
        tzSelect=document.getElementById('tzSelect');

  let lat=40.7608, lon=-111.8910, tz=Intl.DateTimeFormat().resolvedOptions().timeZone;
  let schedule=[], nextRecalcAt=0;

  // populate tz list
  Intl.supportedValuesOf("timeZone").forEach(z=>{
    const o=document.createElement('option');o.value=z;o.text=z;if(z===tz) o.selected=true;tzSelect.appendChild(o);
  });

  function fmt(d){return d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}
  function chaldeanSeq(start,len){const s=ORDER.indexOf(start),out=[];for(let i=0;i<len;i++)out.push(ORDER[(s+i)%7]);return out;}
  function build(date,lat,lon){
    const t=SunCalc.getTimes(date,lat,lon);
    const sunrise=t.sunrise, sunset=t.sunset, nextSunrise=SunCalc.getTimes(new Date(date.getFullYear(),date.getMonth(),date.getDate()+1),lat,lon).sunrise;
    const dayLen=sunset-sunrise, nightLen=nextSunrise-sunset, dh=dayLen/12, nh=nightLen/12;
    const dr=DAY_RULER[date.getDay()], daySeq=chaldeanSeq(dr,12), nightSeq=chaldeanSeq(daySeq[12%7],12);
    const out=[];
    for(let i=0;i<12;i++){out.push({start:new Date(sunrise.getTime()+i*dh),end:new Date(sunrise.getTime()+(i+1)*dh),planet:daySeq[i]});}
    for(let i=0;i<12;i++){out.push({start:new Date(sunset.getTime()+i*nh),end:new Date(sunset.getTime()+(i+1)*nh),planet:nightSeq[i]});}
    nextRecalcAt=nextSunrise.getTime();return {out,sunrise,sunset,nextSunrise,dayRuler:dr,weekdayName:WEEKDAY_NAME[date.getDay()]};
  }
  function renderList(){elList.innerHTML="";schedule.forEach((h,i)=>{const d=document.createElement('div');d.className='hr';d.innerHTML=`<div><strong>${i<12?"Day":"Night"} ${((i)%12)+1}</strong> — ${h.planet}</div><div class="tiny mono">${fmt(h.start)} – ${fmt(h.end)}</div>`;elList.appendChild(d);});}
  function update(){
    const now=new Date(), t=now.getTime();
    if(t>=nextRecalcAt-1000)init(lat,lon,true);
    const cur=schedule.find(h=>t>=h.start.getTime()&&t<h.end.getTime());
    if(!cur)return;
    elCurrent.textContent=cur.planet; elRange.textContent=`${fmt(cur.start)}–${fmt(cur.end)}`;
    elNowtime.textContent=`Current time: ${fmt(now)}`;
    const dr=DAY_RULER[now.getDay()];elDayruler.textContent=`${WEEKDAY_NAME[now.getDay()]} — Ruled by ${dr}`;
    const remainMs=cur.end-t, elapsedMs=t-cur.start.getTime(), dur=cur.end-cur.start;
    elElapsed.textContent=`Elapsed ${Math.floor(elapsedMs/60000)}m`;
    elRemain.textContent=`Remain ${Math.ceil(remainMs/60000)}m`;
    elProgress.style.width=`${100*(1-remainMs/dur)}%`;
    const idx=schedule.indexOf(cur);
    elPrev.textContent=(idx>0?schedule[idx-1].planet:"–");
    elCurTicker.textContent=cur.planet;
    elNext.textContent=(idx<schedule.length-1?schedule[idx+1].planet:"–");
  }
  function init(newLat,newLon,force=false){
    lat=Number(newLat); lon=Number(newLon); tz=tzSelect.value;
    elLocEcho.textContent=`${lat.toFixed(4)}, ${lon.toFixed(4)} (${tz})`;
    const today=new Date();const built=build(new Date(today.getFullYear(),today.getMonth(),today.getDate()),lat,lon);
    schedule=built.out; elSuninfo.textContent=`Sunrise ${fmt(built.sunrise)} • Sunset ${fmt(built.sunset)} • Next sunrise ${fmt(built.nextSunrise)} • ${built.weekdayName} ruled by ${built.dayRuler}`;
    renderList(); update();
  }
  document.getElementById('geoBtn').onclick=()=>navigator.geolocation.getCurrentPosition(pos=>{elLat.value=pos.coords.latitude.toFixed(6);elLon.value=pos.coords.longitude.toFixed(6);init(pos.coords.latitude,pos.coords.longitude,true);});
  document.getElementById('setBtn').onclick=()=>init(elLat.value,elLon.value,true);
  document.getElementById('tzBtn').onclick=()=>init(lat,lon,true);
  init(lat,lon,true); setInterval(update,1000*10);
})();
</script>
</body>
</html>
