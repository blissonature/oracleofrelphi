<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Planetary Hours</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    .card { max-width: 560px; border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .hrs { display: grid; grid-template-columns: 1fr 1fr; gap: 6px 12px; margin-top: 12px; }
    .hr { padding: 6px 8px; border-radius: 8px; border: 1px solid #eee; }
    .hr.now { border-color: #999; font-weight: 600; }
    .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, monospace; }
    .tiny { font-size: 12px; color: #666; }
    .pill { padding: 4px 8px; border: 1px solid #ddd; border-radius: 999px; }
    .bar { height: 8px; background: #eee; border-radius: 999px; overflow: hidden; }
    .bar > div { height: 100%; width: 0%; background: #000; }
    .ruler { position: relative; height: 40px; border: 1px solid #eee; border-radius: 999px; margin: 14px 0; }
    .chip { position: absolute; top: 50%; transform: translate(-50%, -50%);
            padding: 6px 12px; border-radius: 999px; border: 1px solid #ddd; background: white; }
  </style>
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
</head>
<body>
<div class="card">
  <div class="tiny">Current Planetary Hour</div>
  <div id="current" style="font-size: 28px; font-weight: 700;">–</div>
  <div id="planetInfo" class="tiny"></div>
  <div id="clock" class="mono tiny">–</div>

  <div class="row" style="margin-top:6px;">
    <span class="pill mono" id="range">–</span>
    <span class="pill mono" id="countdown">–</span>
    <span class="pill" id="nextPreview">Next: –</span>
    <span class="pill" id="weekday">–</span>
  </div>

  <div class="row" style="margin-top:8px;">
    <label>Timezone
      <select id="tzSelect">
        <option value="America/Denver" data-lat="40.7608" data-lon="-111.8910">America/Denver (Denver)</option>
        <option value="America/Los_Angeles" data-lat="34.0522" data-lon="-118.2437">Los Angeles</option>
        <option value="America/New_York" data-lat="40.7128" data-lon="-74.0060">New York</option>
        <option value="Europe/London" data-lat="51.5074" data-lon="-0.1278">London</option>
        <option value="Australia/Sydney" data-lat="-33.8688" data-lon="151.2093">Sydney</option>
      </select>
    </label>
    <button id="useTzBtn">Use timezone</button>
  </div>

  <div class="ruler">
    <div class="chip" id="chip">–</div>
  </div>

  <div class="bar"><div id="progress"></div></div>
  <div class="tiny" id="suninfo">–</div>
  <div class="hrs" id="list"></div>
</div>

<script>
(function(){
  const ORDER = ["Saturn","Jupiter","Mars","Sun","Venus","Mercury","Moon"];
  const DAY_RULER = {0:"Sun",1:"Moon",2:"Mars",3:"Mercury",4:"Jupiter",5:"Venus",6:"Saturn"};
  const WEEKDAY_NAME = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const INFO = {
    Sun:{sym:"☉",about:"Vitality & Purpose"},
    Moon:{sym:"☽",about:"Cycles & Emotion"},
    Mercury:{sym:"☿",about:"Thought & Exchange"},
    Venus:{sym:"♀",about:"Harmony & Affection"},
    Mars:{sym:"♂",about:"Energy & Action"},
    Jupiter:{sym:"♃",about:"Growth & Wisdom"},
    Saturn:{sym:"♄",about:"Structure & Time"}
  };

  const elCur=document.getElementById('current'), elInfo=document.getElementById('planetInfo'),
        elClock=document.getElementById('clock'), elRange=document.getElementById('range'),
        elCd=document.getElementById('countdown'), elNext=document.getElementById('nextPreview'),
        elWd=document.getElementById('weekday'), elSun=document.getElementById('suninfo'),
        elList=document.getElementById('list'), elProg=document.getElementById('progress'),
        chip=document.getElementById('chip'), tzSel=document.getElementById('tzSelect');

  let tz="America/Denver", lat=40.7608, lon=-111.8910, sched=[];

  function chaldean(start,len){const s=ORDER.indexOf(start);return Array.from({length:len},(_,i)=>ORDER[(s+i)%7]);}
  function fmt(d){return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',timeZone:tz});}
  function clockStr(d){return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',timeZone:tz});}

  function build(){
    const now=new Date();
    // get today's sunrise/sunset
    const times=SunCalc.getTimes(now,lat,lon);
    const tomorrow=new Date(now); tomorrow.setDate(now.getDate()+1);
    const times2=SunCalc.getTimes(tomorrow,lat,lon);

    const sunrise=times.sunrise, sunset=times.sunset, nextSunrise=times2.sunrise;
    const dayHr=(sunset-sunrise)/12, nightHr=(nextSunrise-sunset)/12;
    const wd=new Intl.DateTimeFormat('en-US',{timeZone:tz,weekday:'short'}).format(sunrise);
    const wdi=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].indexOf(wd);
    const seqDay=chaldean(DAY_RULER[wdi],12);
    const seqNight=chaldean(ORDER[(ORDER.indexOf(seqDay[11])+1)%7],12);

    sched=[];
    for(let i=0;i<12;i++) sched.push({planet:seqDay[i],start:new Date(sunrise.getTime()+i*dayHr),end:new Date(sunrise.getTime()+(i+1)*dayHr)});
    for(let i=0;i<12;i++) sched.push({planet:seqNight[i],start:new Date(sunset.getTime()+i*nightHr),end:new Date(sunset.getTime()+(i+1)*nightHr)});

    elSun.textContent=`Sunrise ${fmt(sunrise)} • Sunset ${fmt(sunset)} • Next sunrise ${fmt(nextSunrise)} • ${WEEKDAY_NAME[wdi]} ruled by ${DAY_RULER[wdi]}`;
    elList.innerHTML="";
    sched.forEach((h,j)=>{
      const div=document.createElement('div');
      div.className='hr'; div.innerHTML=`<div><strong>${j<12?"Day":"Night"} ${j%12+1}</strong> — ${INFO[h.planet].sym} ${h.planet}</div><div class="tiny mono">${fmt(h.start)}–${fmt(h.end)}</div>`;
      elList.appendChild(div);
    });
  }

  function tick(){
    const now=new Date();
    elClock.textContent=clockStr(now);
    const cur=sched.find(h=>now>=h.start && now<h.end) || sched[sched.length-1];
    elCur.textContent=cur.planet;
    elInfo.textContent=`${INFO[cur.planet].sym} ${cur.planet} — ${INFO[cur.planet].about}`;
    elRange.textContent=`${fmt(cur.start)}–${fmt(cur.end)}`;
    const next=sched[(sched.indexOf(cur)+1)%24]; elNext.textContent=`Next: ${INFO[next.planet].sym} ${next.planet}`;
    const remain=cur.end-now; const mm=Math.floor(remain/60000)%60, hh=Math.floor(remain/3600000);
    elCd.textContent=`Next in ${hh?hh+":" : ""}${mm.toString().padStart(2,"0")}`;
    const pct=100*((now-cur.start)/(cur.end-cur.start)); elProg.style.width=pct+"%";
    chip.textContent=`${INFO[cur.planet].sym} ${cur.planet}`; chip.style.left=pct+"%";
    [...document.querySelectorAll('.hr')].forEach(div=>div.classList.remove('now'));
    const idx=sched.indexOf(cur); if(idx>=0) elList.children[idx].classList.add('now');
  }

  function init(newTz,newLat,newLon){ tz=newTz; lat=newLat; lon=newLon; build(); tick(); }

  // timezone change
  document.getElementById('useTzBtn').onclick=()=>{
    const opt=tzSel.options[tzSel.selectedIndex];
    init(opt.value, parseFloat(opt.dataset.lat), parseFloat(opt.dataset.lon));
  };

  // default boot Denver
  init("America/Denver",40.7608,-111.8910);
  setInterval(tick,1000);
})();
</script>
</body>
</html>
